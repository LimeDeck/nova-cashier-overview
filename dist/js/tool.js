(()=>{"use strict";var e,t={951:(e,t,n)=>{const r=Vue;var o={class:"text-90 mb-3 text-2xl font-normal"},a=(0,r.createTextVNode)(" Subscription "),i={class:"text-70 font-light"};var c=(0,r.createTextVNode)(" There is no subscription available. "),s={key:0},l={key:1,class:"ml-4 text-red-600 dark:text-red-400"},d={key:2,class:"text-green-600 dark:text-green-400"};var p={class:"md:w-1/4 md:py-3"},u={class:"font-bold md:font-normal"},b={class:"break-words md:w-3/4 md:py-3"},m={class:"text-90"};const g={name:"DisplayRow",props:{label:{type:String,required:!0},isFirst:{type:Boolean,default:!1}}};var f=n(744);const k=(0,f.Z)(g,[["render",function(e,t,n,o,a,i){return(0,r.openBlock)(),(0,r.createElementBlock)("div",{class:(0,r.normalizeClass)(["-mx-6 flex flex-col space-y-2 px-6 py-2 md:flex-row md:space-y-0 md:py-0",{"border-t border-gray-100 dark:border-gray-700":!n.isFirst}])},[(0,r.createElementVNode)("div",p,[(0,r.createElementVNode)("h4",u,[(0,r.createElementVNode)("span",null,(0,r.toDisplayString)(n.label),1)])]),(0,r.createElementVNode)("div",b,[(0,r.createElementVNode)("p",m,[(0,r.renderSlot)(e.$slots,"default")])])],2)}]]),y={name:"DatabaseDetails",components:{DisplayRow:k},props:{loading:{type:Boolean,default:!0},showManageButton:{type:Boolean,default:!0},subscription:{type:Object,default:null}}},v=(0,f.Z)(y,[["render",function(e,t,n,o,a,i){var p=(0,r.resolveComponent)("display-row"),u=(0,r.resolveComponent)("loading-view");return(0,r.openBlock)(),(0,r.createBlock)(u,{loading:n.loading,class:"w-full"},{default:(0,r.withCtx)((function(){return[n.subscription?(0,r.createCommentVNode)("",!0):((0,r.openBlock)(),(0,r.createBlock)(p,{key:0,"is-first":!0,class:"text-70",label:"Status"},{default:(0,r.withCtx)((function(){return[c]})),_:1})),n.subscription?((0,r.openBlock)(),(0,r.createBlock)(p,{key:1,label:"Plan"},{default:(0,r.withCtx)((function(){return[(0,r.createTextVNode)((0,r.toDisplayString)(n.subscription.plan),1)]})),_:1})):(0,r.createCommentVNode)("",!0),n.subscription?((0,r.openBlock)(),(0,r.createBlock)(p,{key:2,label:"Subscribed since"},{default:(0,r.withCtx)((function(){return[(0,r.createTextVNode)((0,r.toDisplayString)(n.subscription.created_at),1)]})),_:1})):(0,r.createCommentVNode)("",!0),n.subscription?((0,r.openBlock)(),(0,r.createBlock)(p,{key:3,class:"remove-bottom-border",label:"Status"},{default:(0,r.withCtx)((function(){return[n.subscription.on_grace_period?((0,r.openBlock)(),(0,r.createElementBlock)("span",s," On Grace Period ")):(0,r.createCommentVNode)("",!0),n.subscription.cancelled||n.subscription.ends_at?((0,r.openBlock)(),(0,r.createElementBlock)("span",l," Cancelled ")):(0,r.createCommentVNode)("",!0),!n.subscription.active||n.subscription.cancelled||n.subscription.ends_at?(0,r.createCommentVNode)("",!0):((0,r.openBlock)(),(0,r.createElementBlock)("span",d," Active "))]})),_:1})):(0,r.createCommentVNode)("",!0)]})),_:1},8,["loading"])}]]);var h={key:0,class:"flex justify-center py-8"},x={key:1},B=(0,r.createTextVNode)(" Stripe subscription management"),N=(0,r.createElementVNode)("option",{value:"",disabled:"disabled",selected:"selected"},"Choose New Plan",-1),S=["value"],C={key:0},V={key:1,class:"ml-4 text-red-600 dark:text-red-400"},_={key:2,class:"text-green-600 dark:text-green-400"};var w={class:"relative mt-8"},E=(0,r.createElementVNode)("div",{class:"border-50 flex items-center border-b py-3"},[(0,r.createElementVNode)("div",{class:"px-3"},"Invoices")],-1),D={class:"relative overflow-hidden overflow-x-auto"},O={class:"w-full"},P={class:"bg-gray-50 dark:bg-gray-800"},T={class:"border-t border-gray-100 px-6 py-2 group-hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:group-hover:bg-gray-900"},A={class:"border-t border-gray-100 py-2 group-hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:group-hover:bg-gray-900"},j={class:"border-t border-gray-100 px-6 py-2 group-hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:group-hover:bg-gray-900"},R={class:"border-t border-gray-100 px-6 py-2 group-hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:group-hover:bg-gray-900"},q={class:"mx-auto border-t border-gray-100 px-6 py-2 text-center group-hover:bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:group-hover:bg-gray-900"},F=["href"];const I={name:"InvoicesTable",props:{invoices:{type:Array,default:function(){return[]}}},data:function(){return{columns:[{label:"Charge ID"},{label:"Amount"},{label:"From"},{label:"To"},{label:"Actions"}]}}},Z={name:"StripeDetails",components:{DisplayRow:k,InvoicesTable:(0,f.Z)(I,[["render",function(e,t,n,o,a,i){return(0,r.openBlock)(),(0,r.createElementBlock)("div",w,[E,(0,r.createElementVNode)("div",D,[(0,r.createElementVNode)("table",O,[(0,r.createElementVNode)("thead",P,[(0,r.createElementVNode)("tr",null,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(e.columns,(function(e){return(0,r.openBlock)(),(0,r.createElementBlock)("th",{key:e.label,class:"text-xxs border-r border-gray-200 py-2 px-6 uppercase tracking-wide text-gray-500 dark:border-gray-600"},(0,r.toDisplayString)(e.label),1)})),128))])]),(0,r.createElementVNode)("tbody",null,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(n.invoices,(function(e){return(0,r.openBlock)(),(0,r.createElementBlock)("tr",{key:e.id,class:"group"},[(0,r.createElementVNode)("td",T,(0,r.toDisplayString)(e.charge_id||"-"),1),(0,r.createElementVNode)("td",A,(0,r.toDisplayString)(e.total/100)+" "+(0,r.toDisplayString)(e.currency),1),(0,r.createElementVNode)("td",j,(0,r.toDisplayString)(e.period_start),1),(0,r.createElementVNode)("td",R,(0,r.toDisplayString)(e.period_end),1),(0,r.createElementVNode)("td",q,[e.link?((0,r.openBlock)(),(0,r.createElementBlock)("a",{key:0,href:e.link,class:"bg-primary-500 hover:bg-primary-400 active:bg-primary-600 inline-flex h-9 flex-shrink-0 flex-shrink-0 items-center rounded px-4 text-sm font-bold text-white shadow focus:outline-none focus:ring dark:text-gray-800",target:"_blank"}," View ",8,F)):(0,r.createCommentVNode)("",!0)])])})),128))])])])])}]])},props:{loading:{type:Boolean,default:!0},subscription:{type:Object,default:null},invoices:{type:Array,default:function(){return[]}},plans:{type:Array,default:function(){return[]}}},data:function(){return{newPlan:""}}},M={components:{DatabaseDetails:v,StripeDetails:(0,f.Z)(Z,[["render",function(e,t,n,o,a,i){var c=(0,r.resolveComponent)("heading"),s=(0,r.resolveComponent)("display-row"),l=(0,r.resolveComponent)("invoices-table"),d=(0,r.resolveComponent)("loading-view");return(0,r.openBlock)(),(0,r.createBlock)(d,{loading:n.loading,class:"w-full"},{default:(0,r.withCtx)((function(){return[n.subscription?(0,r.createCommentVNode)("",!0):((0,r.openBlock)(),(0,r.createElementBlock)("div",h,[(0,r.createElementVNode)("button",{class:"bg-primary-500 hover:bg-primary-400 active:bg-primary-600 mt-2 ml-4 inline-flex h-9 flex-shrink-0 items-center rounded px-4 text-sm font-bold text-white shadow focus:outline-none focus:ring dark:text-gray-800",onClick:t[0]||(t[0]=function(t){return e.$emit("manage-clicked")})}," Manage Stripe subscription ")])),!n.loading&&n.subscription?((0,r.openBlock)(),(0,r.createElementBlock)("div",x,[(0,r.createVNode)(c,{class:"mt-8 mb-4"},{default:(0,r.withCtx)((function(){return[B]})),_:1}),n.subscription?((0,r.openBlock)(),(0,r.createBlock)(s,{key:0,label:"Created"},{default:(0,r.withCtx)((function(){return[(0,r.createTextVNode)((0,r.toDisplayString)(n.subscription.created_at),1)]})),_:1})):(0,r.createCommentVNode)("",!0),n.subscription?((0,r.openBlock)(),(0,r.createBlock)(s,{key:1,label:"Plan"},{default:(0,r.withCtx)((function(){return[(0,r.createTextVNode)((0,r.toDisplayString)(n.subscription.stripe_plan),1)]})),_:1})):(0,r.createCommentVNode)("",!0),n.subscription?((0,r.openBlock)(),(0,r.createBlock)(s,{key:2,label:"Change plan",class:"relative flex"},{default:(0,r.withCtx)((function(){return[(0,r.withDirectives)((0,r.createElementVNode)("select",{"onUpdate:modelValue":t[1]||(t[1]=function(t){return e.newPlan=t}),class:"form-control form-select-bordered form-select block"},[N,((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(n.plans,(function(e){return(0,r.openBlock)(),(0,r.createElementBlock)("option",{key:e.id,value:e.id},(0,r.toDisplayString)(e.id)+" ("+(0,r.toDisplayString)(e.price/100)+" "+(0,r.toDisplayString)(e.currency)+" / "+(0,r.toDisplayString)(e.interval)+") ",9,S)})),128))],512),[[r.vModelSelect,e.newPlan]]),e.newPlan&&e.newPlan!=n.subscription.stripe_plan&&n.subscription.active&&!n.subscription.cancel_at_period_end?((0,r.openBlock)(),(0,r.createElementBlock)("button",{key:0,class:"bg-primary-500 hover:bg-primary-400 active:bg-primary-600 mt-2 inline-flex h-9 flex-shrink-0 flex-shrink-0 items-center rounded px-4 text-sm font-bold text-white shadow focus:outline-none focus:ring dark:text-gray-800",onClick:t[2]||(t[2]=function(t){return e.$emit("update-plan",e.newPlan)})}," Update Plan ")):(0,r.createCommentVNode)("",!0)]})),_:1})):(0,r.createCommentVNode)("",!0),n.subscription?((0,r.openBlock)(),(0,r.createBlock)(s,{key:3,label:"Amount"},{default:(0,r.withCtx)((function(){return[(0,r.createTextVNode)((0,r.toDisplayString)(n.subscription.plan_amount/100)+" ("+(0,r.toDisplayString)(n.subscription.plan_currency)+") / "+(0,r.toDisplayString)(n.subscription.plan_interval),1)]})),_:1})):(0,r.createCommentVNode)("",!0),n.subscription?((0,r.openBlock)(),(0,r.createBlock)(s,{key:4,label:"Billing period"},{default:(0,r.withCtx)((function(){return[(0,r.createTextVNode)((0,r.toDisplayString)(n.subscription.current_period_start)+" => "+(0,r.toDisplayString)(n.subscription.current_period_end),1)]})),_:1})):(0,r.createCommentVNode)("",!0),n.subscription?((0,r.openBlock)(),(0,r.createBlock)(s,{key:5,label:"Status"},{default:(0,r.withCtx)((function(){return[n.subscription.on_grace_period?((0,r.openBlock)(),(0,r.createElementBlock)("span",C,"On Grace Period")):(0,r.createCommentVNode)("",!0),n.subscription.cancelled||n.subscription.cancel_at_period_end?((0,r.openBlock)(),(0,r.createElementBlock)("span",V,"Cancelled")):(0,r.createCommentVNode)("",!0),!n.subscription.active||n.subscription.cancelled||n.subscription.cancel_at_period_end?(0,r.createCommentVNode)("",!0):((0,r.openBlock)(),(0,r.createElementBlock)("span",_,"Active")),!n.subscription.active||n.subscription.cancelled||n.subscription.cancel_at_period_end?(0,r.createCommentVNode)("",!0):((0,r.openBlock)(),(0,r.createElementBlock)("button",{key:3,class:"mt-2 ml-4 inline-flex h-9 flex-shrink-0 flex-shrink-0 items-center rounded bg-red-500 px-4 text-sm font-bold text-white shadow hover:bg-red-300 focus:outline-none focus:ring active:bg-red-600 dark:text-gray-800",onClick:t[3]||(t[3]=function(t){return e.$emit("cancel-subscription")})}," Cancel ")),n.subscription.active&&n.subscription.cancel_at_period_end?((0,r.openBlock)(),(0,r.createElementBlock)("button",{key:4,class:"bg-primary-500 hover:bg-primary-400 active:bg-primary-600 mt-2 ml-4 inline-flex h-9 flex-shrink-0 flex-shrink-0 items-center rounded px-4 text-sm font-bold text-white shadow focus:outline-none focus:ring dark:text-gray-800",onClick:t[4]||(t[4]=function(t){return e.$emit("resume-subscription")})}," Resume ")):(0,r.createCommentVNode)("",!0)]})),_:1})):(0,r.createCommentVNode)("",!0)])):(0,r.createCommentVNode)("",!0),n.invoices.length?((0,r.openBlock)(),(0,r.createBlock)(l,{key:2,invoices:n.invoices},null,8,["invoices"])):(0,r.createCommentVNode)("",!0)]})),_:1},8,["loading"])}]])},props:{resourceName:{type:String,default:""},resourceId:{type:[String,Number],default:""},panel:{type:Object,default:function(){return{}}}},data:function(){return{baseEndpoint:"/nova-vendor/nova-cashier-overview/",loading:{database:!0,stripe:!1},databaseSubscription:null,stripeSubscription:null,invoices:[],plans:[]}},computed:{subscriptionName:function(){return this.panel.fields[0].subscription||"default"}},mounted:function(){this.fetchDatabaseSubscription()},methods:{fetchDatabaseSubscription:function(){var e=this;Nova.request().get("".concat(this.baseEndpoint,"billable/").concat(this.resourceId,"/?subscription=").concat(this.subscriptionName)).then((function(t){e.databaseSubscription=t.data.subscription,e.loading.database=!1}))},fetchStripeSubscription:function(){var e=this;this.loading.stripe=!0,Nova.request().get("".concat(this.baseEndpoint,"subscriptions/").concat(this.databaseSubscription.id)).then((function(t){e.stripeSubscription=t.data.subscription,e.invoices=t.data.invoices,e.plans=t.data.plans,e.loading.stripe=!1}))},updatePlan:function(e){var t=this;this.loading.stripe=!0,Nova.request().put("".concat(this.baseEndpoint,"subscriptions/").concat(this.databaseSubscription.id),{plan:e}).then((function(){Nova.success("Updated successfully!"),t.fetchStripeSubscription()})).catch((function(e){Nova.error(e.response.data.message)}))},resumeSubscription:function(){var e=this;this.loading.stripe=!0,this.loading.database=!0,Nova.request().post("".concat(this.baseEndpoint,"subscriptions/").concat(this.databaseSubscription.id,"/resume")).then((function(){Nova.success("Resumed successfully!"),e.fetchDatabaseSubscription(),e.fetchStripeSubscription()})).catch((function(e){Nova.error(e.response.data.message)}))},cancelSubscription:function(){var e=this;this.loading.stripe=!0,this.loading.database=!0,Nova.request().post("".concat(this.baseEndpoint,"subscriptions/").concat(this.databaseSubscription.id,"/cancel")).then((function(){Nova.success("Cancelled successfully!"),e.fetchDatabaseSubscription(),e.fetchStripeSubscription()})).catch((function(e){Nova.error(e.response.data.message)}))}}},U=(0,f.Z)(M,[["render",function(e,t,n,c,s,l){var d=(0,r.resolveComponent)("database-details"),p=(0,r.resolveComponent)("stripe-details"),u=(0,r.resolveComponent)("card");return(0,r.openBlock)(),(0,r.createElementBlock)("div",null,[(0,r.createElementVNode)("h1",o,[a,(0,r.createElementVNode)("span",i,"("+(0,r.toDisplayString)(l.subscriptionName)+")",1)]),(0,r.createVNode)(u,{class:"mb-6 flex flex-col py-3 px-6"},{default:(0,r.withCtx)((function(){return[(0,r.createVNode)(d,{subscription:e.databaseSubscription,loading:e.loading.database},null,8,["subscription","loading"]),e.databaseSubscription?((0,r.openBlock)(),(0,r.createBlock)(p,{key:0,subscription:e.stripeSubscription,invoices:e.invoices,plans:e.plans,loading:e.loading.stripe,onManageClicked:l.fetchStripeSubscription,onUpdatePlan:l.updatePlan,onCancelSubscription:l.cancelSubscription,onResumeSubscription:l.resumeSubscription},null,8,["subscription","invoices","plans","loading","onManageClicked","onUpdatePlan","onCancelSubscription","onResumeSubscription"])):(0,r.createCommentVNode)("",!0)]})),_:1})])}]]);Nova.booting((function(e,t){e.component("Subscription",U)}))},762:()=>{},744:(e,t)=>{t.Z=(e,t)=>{const n=e.__vccOpts||e;for(const[e,r]of t)n[e]=r;return n}}},n={};function r(e){var o=n[e];if(void 0!==o)return o.exports;var a=n[e]={exports:{}};return t[e](a,a.exports,r),a.exports}r.m=t,e=[],r.O=(t,n,o,a)=>{if(!n){var i=1/0;for(d=0;d<e.length;d++){for(var[n,o,a]=e[d],c=!0,s=0;s<n.length;s++)(!1&a||i>=a)&&Object.keys(r.O).every((e=>r.O[e](n[s])))?n.splice(s--,1):(c=!1,a<i&&(i=a));if(c){e.splice(d--,1);var l=o();void 0!==l&&(t=l)}}return t}a=a||0;for(var d=e.length;d>0&&e[d-1][2]>a;d--)e[d]=e[d-1];e[d]=[n,o,a]},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={103:0,990:0};r.O.j=t=>0===e[t];var t=(t,n)=>{var o,a,[i,c,s]=n,l=0;if(i.some((t=>0!==e[t]))){for(o in c)r.o(c,o)&&(r.m[o]=c[o]);if(s)var d=s(r)}for(t&&t(n);l<i.length;l++)a=i[l],r.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return r.O(d)},n=self.webpackChunklimedeck_nova_cashier_overview=self.webpackChunklimedeck_nova_cashier_overview||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})(),r.O(void 0,[990],(()=>r(951)));var o=r.O(void 0,[990],(()=>r(762)));o=r.O(o)})();